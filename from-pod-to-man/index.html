<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>From Pod to man - twiddling bits</title><meta name=description content="bits of blogging"><meta name=generator content="Hugo 0.98.0"><link rel=stylesheet href="/css/main.min.04412606b0a857b62d4a012cea6f7819fbace275a9acfbd525f987b274f9386c.css"><script data-goatcounter=https://twiddlingbits.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body class="flex flex-col h-screen mx-6 md:mx-auto my-auto max-w-2xl"><div class=py-6><nav class="flex flex-row justify-between text-lg"><div class="flex items-center gap-x-4"><a href=https://twiddlingbits.net><img src=https://twiddlingbits.net/images/icon.png width=24 height=24></a>
<a class="invisible sm:visible font-bold hover:underline" href=https://twiddlingbits.net>twiddling bits</a></div><ul class="flex flex-row gap-x-1 sm:gap-x-4"><li class="flex items-center gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg><a class="underline hover:no-underline" href=/about title>about</a></li><li class="flex items-center gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414.0l-7-7A.997.997.0 012 10V5a3 3 0 013-3h5c.256.0.512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg><a class="underline hover:no-underline" href=/tags/ title>tags</a></li></ul></nav></div><main class=flex-grow><article class="gap-y-2 post-border pt-6 md:pt-12"><h1 class="text-2xl font-bold">From Pod to man</h1><div class="flex flex-col gap-y-1 py-4 text-gray-500"><span class=italic>Jan 30, 2022</span><div class="flex flex-row gap-x-4"><div class="flex gap-x-1 italic"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3A9 9 0 113 12a9 9 0 0118 0z"/></svg>4 mins</div><div class="flex gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414.0l-7-7A.997.997.0 012 10V5a3 3 0 013-3h5c.256.0.512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg><ul class="flex flex-row flex-wrap gap-x-2"><li><a class=tag href=/tags/documentation>#documentation</a></li><li><a class=tag href=/tags/markup>#markup</a></li><li><a class=tag href=/tags/development>#development</a></li></ul></div></div></div><div class=prose><p>While developing many of my projects I&rsquo;ve found myself faced with the timeless
question: to document or not to document? My goal is to provide <a href=https://en.wikipedia.org/wiki/Man_page>man
pages</a> for any project used from the command-line or designed to be
integrated into a larger Linux ecosystem. And so, at the onset of my open-source
journey, I stood at a crossroad: learn the unwieldy <a href=https://en.wikipedia.org/wiki/Troff>troff</a> format of man
pages or set up a process to build them from an alternative markup format.</p><p>This is an excerpt from the <code>time</code> command&rsquo;s man page written in <code>troff</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-man data-lang=man><span class=line><span class=cl>.<span class=k>TH</span> <span class=s>TIME</span> <span class=m>1</span> <span class=m>2019</span><span class=s>-03-06</span> <span class=s>&#34;&#34;</span> <span class=s2>&#34;Linux User&#39;s Manual&#34;</span>
</span></span><span class=line><span class=cl>.<span class=k>SH</span> <span class=s>NAME</span>
</span></span><span class=line><span class=cl>time <span class=se>\-</span> time a simple command or give resource usage
</span></span><span class=line><span class=cl>.<span class=k>SH</span> <span class=s>SYNOPSIS</span>
</span></span><span class=line><span class=cl>.<span class=k>B</span> <span class=s>time</span> <span class=se>\c</span>
</span></span><span class=line><span class=cl>.<span class=k>RI</span> <span class=s>[</span> <span class=s>options</span> <span class=s>]</span> <span class=s2>&#34; command &#34;</span> <span class=s>[</span> <span class=s>arguments...</span> <span class=s>]</span>
</span></span><span class=line><span class=cl>.<span class=k>SH</span> <span class=s>DESCRIPTION</span>
</span></span><span class=line><span class=cl>The
</span></span><span class=line><span class=cl>.<span class=k>B</span> <span class=s>time</span>
</span></span><span class=line><span class=cl>command runs the specified program
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s>command</span>
</span></span><span class=line><span class=cl>with the given arguments.
</span></span><span class=line><span class=cl>When
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s>command</span>
</span></span><span class=line><span class=cl>finishes,
</span></span><span class=line><span class=cl>.<span class=k>B</span> <span class=s>time</span>
</span></span><span class=line><span class=cl>writes a message to standard error giving timing statistics
</span></span><span class=line><span class=cl>about this program run.
</span></span><span class=line><span class=cl>These statistics consist of (i) the elapsed real time
</span></span><span class=line><span class=cl>between invocation and termination, (ii) the user CPU time
</span></span><span class=line><span class=cl>(the sum of the
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s>tms_utime</span>
</span></span><span class=line><span class=cl>and
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s>tms_cutime</span>
</span></span><span class=line><span class=cl>values in a
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s2>&#34;struct tms&#34;</span>
</span></span><span class=line><span class=cl>as returned by
</span></span><span class=line><span class=cl>.<span class=k>BR</span> <span class=s>times</span> <span class=s>(2)),</span>
</span></span><span class=line><span class=cl>and (iii) the system CPU time (the sum of the
</span></span><span class=line><span class=cl>.<span class=k>I</span>  <span class=s>tms_stime</span>
</span></span><span class=line><span class=cl>and
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s>tms_cstime</span>
</span></span><span class=line><span class=cl>values in a
</span></span><span class=line><span class=cl>.<span class=k>I</span> <span class=s2>&#34;struct tms&#34;</span>
</span></span><span class=line><span class=cl>as returned by
</span></span><span class=line><span class=cl>.<span class=k>BR</span> <span class=s>times</span> <span class=s>(2)).</span>
</span></span><span class=line><span class=cl>.<span class=k>PP</span>
</span></span><span class=line><span class=cl>Note: some shells (e.g.,
</span></span><span class=line><span class=cl>.<span class=k>BR</span> <span class=s>bash</span> <span class=s>(1))</span>
</span></span><span class=line><span class=cl>have a built-in
</span></span><span class=line><span class=cl>.<span class=k>B</span> <span class=s>time</span>
</span></span><span class=line><span class=cl>command that provides similar information on the usage of time and
</span></span><span class=line><span class=cl>possibly other resources.
</span></span><span class=line><span class=cl>To access the real command, you may need to specify its pathname
</span></span><span class=line><span class=cl>(something like
</span></span><span class=line><span class=cl>.<span class=k>IR</span> <span class=s>/usr/bin/time</span> <span class=s>).</span>
</span></span></code></pre></div><p>From my perspective, an alternative is <em>necessary</em>. The markup syntax is cryptic
and what would be inline markup in other formats requires a newline in <em>troff</em>.</p><p>There are numerous means of generating man pages from assorted markup formats.
For example, using:</p><ul><li><em>reStructured text</em> with <a href=https://manpages.debian.org/testing/docutils-common/rst2man.1.en.html><code>rst2man</code></a>,</li><li><em>AsciiDoc</em> format with <a href=https://docs.asciidoctor.org/asciidoctor/latest/manpage-backend/><code>AsciiDoc</code></a> itself,</li><li><em>Markdown</em> with <a href=https://spin.atomicobject.com/2015/05/06/man-pages-in-markdown-ronn/><code>ronn</code></a> or <a href=https://gabmus.org/posts/man_pages_with_markdown_and_pandoc/><code>pandoc</code></a>,</li><li>or <em>Pod</em> with <a href=https://perldoc.perl.org/pod2man><code>pod2man</code></a></li></ul><p>to name a few.</p><p>Admittedly, I&rsquo;d enjoy writing man pages in <em>Markdown</em>, but in approaching the
question of an appropriate build pipeline, I decided early on that I&rsquo;d like to
avoid any external depedencies. This eliminates most options, but the <code>pod2man</code>
command is available by default in the Linux distributions I&rsquo;ve used. With this
in mind, Perl&rsquo;s <a href=https://perldoc.perl.org/perlpod><em>Pod</em></a>, or Plain Old Documentation, is the top contender.</p><p>Here&rsquo;s an example of a <em>Pod</em>-formatted man page from my <a href=https://github.com/jcrd/iniq><code>iniq</code></a> project:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-md data-lang=md><span class=line><span class=cl>=head1 NAME
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iniq - INI file reader
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=head1 SYNOPSIS
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>B<span class=p>&lt;</span><span class=nt>iniq</span><span class=p>&gt;</span> [options] [FILE]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>With no FILE, read standard input.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=head1 DESCRIPTION
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iniq is a simple INI file reader for the command line. It queries an INI file
</span></span><span class=line><span class=cl>based on the path <span class=p>&lt;</span><span class=nt>I</span><span class=err>&lt;</span><span class=na>section</span><span class=p>&gt;</span>&gt;<span class=p>&lt;</span><span class=nt>I</span><span class=err>&lt;</span><span class=na>separator</span><span class=p>&gt;</span>&gt;<span class=p>&lt;</span><span class=nt>I</span><span class=err>&lt;</span><span class=na>key</span><span class=p>&gt;</span>&gt; and allows use of custom
</span></span><span class=line><span class=cl>separators in the file and formatting of the output. Sections inherit keys from
</span></span><span class=line><span class=cl>a special DEFAULT section unless the I<span class=p>&lt;</span><span class=nt>-D</span><span class=p>&gt;</span> flag is used. See below for examples.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=head1 OPTIONS
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=over
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-h</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Show help message.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-q</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Suppress error messages.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-d</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Include DEFAULT section in section list.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-D</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disable inheriting of DEFAULT section.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-s</span><span class=p>&gt;</span> I<span class=p>&lt;</span><span class=nt>SEPARATORS</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Key/value pair separators. Default is &#39;=:&#39;.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-m</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Parse multi-line entries. An entry spans multiple lines if subsequent lines are
</span></span><span class=line><span class=cl>indented deeper than the first line.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-c</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Combine sections with the same name.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=item B<span class=p>&lt;</span><span class=nt>-P</span><span class=p>&gt;</span> I<span class=p>&lt;</span><span class=nt>SEPARATOR</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Path separator character. Default is &#39;.&#39;.
</span></span></code></pre></div><p>Compared to <em>troff</em>, this is both easier to write and to read, which are
important qualities in the maintenance of documentation.</p><h2 id=converting-pod-files-to-man-pages>Converting <code>.pod</code> files to man pages</h2><p>Producing a man page from a <code>.pod</code> file is straightforward using the <code>pod2man</code>
command. In most of my projects, this step is part of a <code>Makefile</code>.</p><p>In the case of <code>iniq</code>, these <code>Makefile</code> rules build and install its man page:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nv>VERSIONCMD</span> <span class=o>=</span> git describe --dirty --tags --always 2&gt; /dev/null
</span></span><span class=line><span class=cl><span class=nv>VERSION</span> <span class=o>:=</span> <span class=k>$(</span>shell <span class=k>$(</span>VERSIONCMD<span class=k>)</span> <span class=o>||</span> cat VERSION<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>PREFIX</span> <span class=o>?=</span> /usr/local
</span></span><span class=line><span class=cl><span class=nv>MANPREFIX</span> <span class=o>?=</span> <span class=k>$(</span>PREFIX<span class=k>)</span>/share/man
</span></span><span class=line><span class=cl><span class=nv>MANPAGE</span> <span class=o>=</span> iniq.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(MANPAGE)</span><span class=o>:</span> <span class=n>man</span>/<span class=k>$(</span><span class=nv>MANPAGE</span><span class=k>)</span>.<span class=n>pod</span>
</span></span><span class=line><span class=cl>	pod2man -n<span class=o>=</span>iniq -c<span class=o>=</span>iniq -s<span class=o>=</span><span class=m>1</span> -r<span class=o>=</span><span class=k>$(</span>VERSION<span class=k>)</span> $&lt; <span class=k>$(</span>MANPAGE<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>install</span><span class=o>:</span> <span class=k>$(</span><span class=nv>MANPAGE</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	mkdir -p <span class=k>$(</span>DESTDIR<span class=k>)$(</span>MANPREFIX<span class=k>)</span>/man1
</span></span><span class=line><span class=cl>	cp -p <span class=k>$(</span>MANPAGE<span class=k>)</span> <span class=k>$(</span>DESTDIR<span class=k>)$(</span>MANPREFIX<span class=k>)</span>/man1
</span></span></code></pre></div><p>The conversion command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pod2man -n<span class=o>=</span><span class=nv>$name</span> -c<span class=o>=</span><span class=nv>$header</span> -s<span class=o>=</span><span class=nv>$section</span> -r<span class=o>=</span><span class=nv>$footer</span> <span class=nv>$input</span> <span class=nv>$output</span>
</span></span></code></pre></div><ul><li>takes the input <code>.pod</code> file as its first positional argument,</li><li>and the output file name as its second;</li><li>the <code>-n</code> flag sets the man page name,</li><li>the <code>-c</code> flag sets the page header,</li><li>the <code>-s</code> flag sets the section, which should match the output file&rsquo;s
extension,</li><li>the <code>-r</code> flag sets the page footer, which in my projects is always the
version.</li></ul><h2 id=more-information>More information</h2><p>Descriptions of <code>pod2man</code>&rsquo;s various options can be found <a href=https://perldoc.perl.org/pod2man>here</a> or in
its man page using <code>man pod2man</code>; and with that we&rsquo;ve come full circle!</p></div></article><div class="flex justify-center mt-2 text-gray-300 gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path d="M17.414 2.586a2 2 0 00-2.828.0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/></svg><a class=hover:underline href=https://github.com/jcrd/jcrd.github.io/commit/215b0771cce00bcbf66e383af19afee1660b082a>215b077</a></div></main><div class=py-10><footer class="flex flex-col gap-y-2"><div class="flex justify-center gap-x-1"><a class=hover:underline href=https://twiddlingbits.net/about>James Reed</a><p class=text-gray-500>&nbsp;&copy;
2022
&sdot;</p><a class=hover:underline href=https://twiddlingbits.net>twiddling bits</a>
<a class=text-gray-500 type=application/rss+xml href=https://twiddlingbits.net/posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path d="M5 3a1 1 0 000 2c5.523.0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"/><path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5A1 1 0 014 9zM3 15a2 2 0 114 0 2 2 0 01-4 0z"/></svg></a></div></footer></div></body></html>