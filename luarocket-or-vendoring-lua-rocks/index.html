<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>luarocket, or vendoring Lua rocks - twiddling bits</title><meta name=description content="bits of blogging"><meta name=generator content="Hugo 0.99.1"><link rel=stylesheet href="/css/main.min.37052f34cf31a41ae489af9274c018f590fe483947c3b3a05ed95a3d0b1f7c2b.css"><script data-goatcounter=https://twiddlingbits.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body class="flex flex-col h-screen mx-6 md:mx-auto my-auto max-w-2xl"><div class=py-6><nav class="flex flex-row justify-between text-lg"><div class="flex items-center gap-x-4"><a href=https://twiddlingbits.net><img src=https://twiddlingbits.net/images/icon.png width=24 height=24></a>
<a class="invisible sm:visible font-bold hover:underline" href=https://twiddlingbits.net>twiddling bits</a></div><ul class="flex flex-row gap-x-1 sm:gap-x-4"><li class="flex items-center gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg><a class="underline hover:no-underline" href=/about title>about</a></li><li class="flex items-center gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 16" fill="currentcolor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414.0l-7-7A.997.997.0 012 10V5a3 3 0 013-3h5c.256.0.512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg><a class="underline hover:no-underline" href=/tags/ title>tags</a></li></ul></nav></div><main class=flex-grow><article class="gap-y-2 post-border pt-6 md:pt-12"><h1 class="text-2xl font-bold">luarocket, or vendoring Lua rocks</h1><div class="flex flex-col gap-y-1 py-4 text-gray-500"><span class=italic>Apr 24, 2022</span><div class="flex gap-x-1 italic"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3A9 9 0 113 12a9 9 0 0118 0z"/></svg>2 mins</div></div><div class="flex flex-col gap-y-6 md:gap-y-12"><div class=prose><p>The Lua programming language, like many others, employs a purpose-built package
manager to download and install its ecosystem of libraries. This tool,
<a href=https://luarocks.org/>LuaRocks</a>, has some notable features:</p><ul><li>downloads/installs packages to user-specific or system-wide locations</li><li>configurable dependency resolution</li><li>builds locally define rocks (Lua modules packaged by LuaRocks)</li><li>queries information about the active LuaRocks configuration</li></ul><p>In these ways, LuaRocks is functionally similar to the package managers of other
dynamic languages such as <a href=https://pip.pypa.io/en/stable/>pip</a> for Python and <a href=https://www.npmjs.com/>npm</a> for JavaScript.</p><p>Where these features fall short is in managing the dependencies of multiple Lua
projects—each with a potentially different version of Lua. Being that Lua is an
<a href=https://www.lua.org/pil/24.html><em>embedded language</em></a>, this is in fact common, and further
exacerbated by the popularity of both the reference <a href=https://www.lua.org/>Lua</a> implementation
and <a href=https://luajit.org/>luajit</a>.</p><h2 id=problem>Problem</h2><p>I encountered this issue during the development of an experimental window
manager, <a href=https://github.com/jcrd/dovetail>dovetail</a>. It is based on the <a href=https://awesomewm.org/>awesome window
manager</a> framework, which can be built with Lua versions 5.1-5.3 or
luajit. It also depends on a few Lua packages, and therein lies the problem. It
quickly became an overwhelming task to unify the range of Lua versions and
implementations, 3rd party packages, varying installation paths, and integration
with an embedded interpreter.</p><h2 id=solution>Solution</h2><p>After consideration of my options, I decided the easiest solution was to vendor
all dependency packages. I set up Makefile rules to download the version of
packages specified in a version-controlled file to a specific Lua rocks tree
where the package’s files are extracted and moved into a <code>lua_modules</code> directory
in the root of the project. During installation, these modules are copied to a
system-wide shared data directory and referenced by awesome’s Lua interpreter.</p><p>When I required this functionality outside of the dovetail project, I
re-implemented these Makefile rules as a shell script called
<a href=https://github.com/jcrd/luarocket>luarocket</a>. It is meant to be included directly in a project and
utilized as part of its build process.</p><h2 id=references>References</h2><ul><li><a href=https://github.com/jcrd/luarocket>luarocket</a>: Vendor Lua rocks into a local project directory</li></ul></div><div class="flex justify-between pt-4"><div class="flex gap-x-4 text-gray-500"><div class="flex gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 16" fill="currentcolor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414.0l-7-7A.997.997.0 012 10V5a3 3 0 013-3h5c.256.0.512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg><ul class="flex flex-row flex-wrap gap-x-2"><li><a class=tag href=/tags/lua>#lua</a></li><li><a class=tag href=/tags/development>#development</a></li><li><a class=tag href=/tags/project>#project</a></li></ul></div></div><div class="flex text-gray-300 gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path d="M17.414 2.586a2 2 0 00-2.828.0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/></svg><a class=hover:underline href=https://github.com/jcrd/jcrd.github.io/commit/4129ba8fb0dda8f2d75f9d38ca6a61ed2e594ee1>4129ba8</a></div></div></div></article></main><div class=py-10><footer class="flex flex-col gap-y-2"><div class="flex justify-center gap-x-1"><a class=hover:underline href=https://twiddlingbits.net/about>James Reed</a><p class=text-gray-500>&nbsp;&copy;
2022
&sdot;</p><a class=hover:underline href=https://twiddlingbits.net>twiddling bits</a>
<a class=text-gray-500 type=application/rss+xml href=https://twiddlingbits.net/posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentcolor"><path d="M5 3a1 1 0 000 2c5.523.0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"/><path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5A1 1 0 014 9zM3 15a2 2 0 114 0 2 2 0 01-4 0z"/></svg></a></div><div class="flex justify-center gap-x-1"><a href=https://ko-fi.com/twiddlingbits><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5.0 000 6.364L12 20.364l7.682-7.682a4.5 4.5.0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5.0 00-6.364.0z"/></svg></a><a class="text-gray-500 text-sm hover:underline" href=https://ko-fi.com/twiddlingbits>support</a></div></footer></div></body></html>