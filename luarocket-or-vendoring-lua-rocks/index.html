<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>luarocket, or vendoring Lua rocks - twiddling bits</title><meta name=description content="bits of blogging"><meta name=generator content="Hugo 0.101.0"><link rel=stylesheet href="/css/main.min.1beca2f50c07921732b306fad264177b4b4110031e9dd947c951b2fb6a972cdd.css"><script data-goatcounter=https://twiddlingbits.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body class="flex flex-col min-h-screen mx-6 md:mx-auto my-auto max-w-2xl"><main class="flex-grow pt-6 md:pt-12"><article class=gap-y-2><h1 class="text-2xl font-bold">luarocket, or vendoring Lua rocks</h1><div class=py-4><div class="flex gap-x-3 text-gray-500"><div class="flex gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg><span class=italic>Apr 24, 2022</span></div>&bull;<div class="flex gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3A9 9 0 113 12a9 9 0 0118 0z"/></svg><span class=italic>2 mins</span></div></div></div><div class="flex flex-col gap-y-6 md:gap-y-12"><div class=prose><p>The Lua programming language, like many others, employs a purpose-built package
manager to download and install its ecosystem of libraries. This tool,
<a href=https://luarocks.org/>LuaRocks</a>, has some notable features:</p><ul><li>downloads/installs packages to user-specific or system-wide locations</li><li>configurable dependency resolution</li><li>builds locally define rocks (Lua modules packaged by LuaRocks)</li><li>queries information about the active LuaRocks configuration</li></ul><p>In these ways, LuaRocks is functionally similar to the package managers of other
dynamic languages such as <a href=https://pip.pypa.io/en/stable/>pip</a> for Python and <a href=https://www.npmjs.com/>npm</a> for JavaScript.</p><p>Where these features fall short is in managing the dependencies of multiple Lua
projects—each with a potentially different version of Lua. Being that Lua is an
<a href=https://www.lua.org/pil/24.html><em>embedded language</em></a>, this is in fact common, and further
exacerbated by the popularity of both the reference <a href=https://www.lua.org/>Lua</a> implementation
and <a href=https://luajit.org/>luajit</a>.</p><h2 id=problem>Problem</h2><p>I encountered this issue during the development of an experimental window
manager, <a href=https://github.com/jcrd/dovetail>dovetail</a>. It is based on the <a href=https://awesomewm.org/>awesome window
manager</a> framework, which can be built with Lua versions 5.1-5.3 or
luajit. It also depends on a few Lua packages, and therein lies the problem. It
quickly became an overwhelming task to unify the range of Lua versions and
implementations, 3rd party packages, varying installation paths, and integration
with an embedded interpreter.</p><h2 id=solution>Solution</h2><p>After consideration of my options, I decided the easiest solution was to vendor
all dependency packages. I set up Makefile rules to download the version of
packages specified in a version-controlled file to a specific Lua rocks tree
where the package’s files are extracted and moved into a <code>lua_modules</code> directory
in the root of the project. During installation, these modules are copied to a
system-wide shared data directory and referenced by awesome’s Lua interpreter.</p><p>When I required this functionality outside of the dovetail project, I
re-implemented these Makefile rules as a shell script called
<a href=https://github.com/jcrd/luarocket>luarocket</a>. It is meant to be included directly in a project and
utilized as part of its build process.</p><h2 id=references>References</h2><ul><li><a href=https://github.com/jcrd/luarocket>luarocket</a>: Vendor Lua rocks into a local project directory</li></ul></div></div></article><div class=pt-8><div class="flex ml-1 italic text-sm text-gray-400"></div></div></main><div class=py-10><footer class="flex gap-x-1"><p class=text-gray-500>&nbsp;&copy;
2022</p><a class=hover:underline href=https://twiddlingbits.net>James Reed</a>
<a class=text-gray-300 type=application/rss+xml href=https://twiddlingbits.net/posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" viewBox="0 0 20 20" fill="currentcolor"><path d="M5 3a1 1 0 000 2c5.523.0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"/><path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5A1 1 0 014 9zM3 15a2 2 0 114 0 2 2 0 01-4 0z"/></svg></a></footer></div></body></html>