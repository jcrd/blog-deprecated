<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="bits of blogging"><meta name="generator" content="Eleventy"><link rel="icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>Introducing sessiond</title><link rel="stylesheet" href="/jcrd.github.io/site.css"><link rel="stylesheet" href="/jcrd.github.io/prism-one-dark.css"></head><body class="flex flex-col min-h-screen mx-6 md:mx-auto my-auto max-w-2xl"><main class="flex-grow pt-6 md:pt-12"><div class="flex flex-col md-960:flex-row"><div class="mb-4 md-960:-ml-32 md-960:mr-8"><a href="https://twiddlingbits.net/"><img src="https://www.gravatar.com/avatar/6dd0c8e5214e4c4d0f0dafabebe82c3d?size=96"></a></div><div class="pt-4"><article><h1 class="text-2xl font-bold">Introducing sessiond</h1><div class="flex gap-x-2 pt-1 pb-10 text-gray-400"><div class="flex gap-x-1">Last updated: <span class="italic">Jan 25, 2022</span></div>&bull;<div class="flex gap-x-1">Read in: <span class="italic">5 minutes</span></div></div><div class="prose"><p>When I began using Linux on the desktop in ~2012, I experimented with the prevalent desktop environments (Gnome, KDE, etc.), but was quickly drawn into the realm of tiling window managers by their promise of increased productivity and customization. While I believe these promises were fulfilled, tiling window managers were not without a significant shortcoming: they are solely window managers, lacking the integrated suite of software and applications that put the environment in desktop environments.</p><p>The most noticeable omission was proper <em>session management</em>, which facilitates, for instance: locking the screen or suspending the system after a period of inactivity. This was not a dealbreaker on a desktop computer, but using a laptop without these features felt like a dysfunctional hack.</p><p>It would be quite a few more years of exploring the universe of tiling window managers before deciding to address this issue myself, and with the broad adoption of <em>systemd</em> by the larger Linux ecosystem, it was easier than ever. Enter: <strong>sessiond</strong>, a standalone session manager for Linux.</p><h2>What does it do?</h2><p>sessiond is a daemon for <em>systemd</em>-based Linux systems that interfaces with <em>systemd-logind</em> to provide the missing session management features to X11 window managers. Its primary responsibility is to monitor keyboard and mouse activity to determine when a session has become idle, and to then act accordingly. It is capable of:</p><ul><li>locking the screen when idle and before suspending the system</li><li>dimming the screen's backlight when idle</li><li>triggering <em>systemd</em> targets for use by the window manager or end user</li><li>optionally managing DPMS settings</li><li>controlling keyboard and monitor backlight brightness</li><li>controlling audio sink volume and mute state <strong>*</strong></li></ul><div class="flex flex-col"><div class="bg-green-200 rounded-t font-bold">&nbsp;* Update</div><div class="border border-t-0 rounded-b pl-1"><span class="prose"><p>The audio sink interface is new in version <strong>0.6.0</strong>.</p></span></div></div><p>It also provides a DBus service so that it may be integrated with modern window managers. For example, a window manager can prevent idling when a media player is open by interacting with the DBus methods.</p><p>It is designed to be zero-configuration, providing sensible defaults, but allows configuration if needed. See <a href="https://sessiond.org/configuration/">here</a> for additional details.</p><h2>How do I use it?</h2><p>sessiond requires a Linux system utilizing <em>systemd-logind</em>. It may be possible to use <a href="https://github.com/elogind/elogind">elogind</a> but this has not been tested.</p><div class="flex flex-col"><div class="bg-blue-200 rounded-t font-bold">&nbsp;Note</div><div class="border border-t-0 rounded-b pl-1"><span class="prose"><p>This brief tutorial assumes basic knowledge of <em>systemd</em>-based Linux systems and the command-line.</p></span></div></div><h3>Installation</h3><p>Currently, sessiond RPM packages are built for Fedora via <a href="https://copr.fedorainfracloud.org/coprs/jcrd/sessiond/">copr</a> and installable with the following commands:</p><pre class="language-shell"><code class="language-shell">dnf copr <span class="token builtin class-name">enable</span> jcrd/sessiond<br>dnf <span class="token function">install</span> sessiond</code></pre><p>I would like to see packages for other major distros in the future. Until sessiond achieves world domination, it is recommended to build from source by following <a href="https://sessiond.org/building/">these instructions</a>.</p><p>If you package sessiond for your distribution, please let me know by creating an issue <a href="https://github.com/jcrd/sessiond.org/issues">here</a>.</p><h3>Setting up your window manager</h3><p>The intended way to use sessiond with your window manager of choice is to create a custom <em>systemd</em> service in the <code>~/.config/systemd/user</code> directory. For example, below is a <code>awesome.service</code> file that runs the <a href="https://awesomewm.org/">Awesome</a> window manager:</p><pre class="language-systemd"><code class="language-systemd"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Awesome window manager</span><br><span class="token key attr-name">Requires</span><span class="token punctuation">=</span><span class="token value attr-value">sessiond-session.target</span><br><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">sessiond.service</span><br><span class="token key attr-name">PartOf</span><span class="token punctuation">=</span><span class="token value attr-value">graphical-session.target</span><br><br><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/awesome</span><br><br><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">Alias</span><span class="token punctuation">=</span><span class="token value attr-value">window-manager.service</span></code></pre><p>The options in the <code>[Unit]</code> section ensure your window manager is only running alongside the sessiond daemon. The <code>Alias=</code> option in the <code>[Install]</code> section lets sessiond know this service is the window manager so the session will be stopped when it exits.</p><p>Next, enable the window manager service with <code>systemctl --user enable awesome.service</code>.</p><p>Now, select the <code>sessiond session</code> entry via your display manager or set it as the default in its configuration file. For example, if using <code>lightdm</code>, set <code>user-session=sessiond</code> in <code>/etc/lightdm/lightdm.conf</code>.</p><h3>Locking the session</h3><p>sessiond wouldn't be of much use without a means by which to lock the screen. Create a service for your screen locker of choice in <code>~/.config/systemd/user</code>. For example, here is a <code>i3lock.service</code> that runs <code>i3lock</code> as the screen locker:</p><pre class="language-systemd"><code class="language-systemd"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Lock X session with i3lock</span><br><span class="token key attr-name">PartOf</span><span class="token punctuation">=</span><span class="token value attr-value">graphical-session.target</span><br><br><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/i3lock</span><br><span class="token key attr-name">ExecStopPost</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/sessionctl unlock</span><br><br><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">graphical-lock.target</span></code></pre><p>The <code>sessionctl unlock</code> command in <code>ExecStopPost</code> under the <code>[Service]</code> section notifies sessiond that the session has been unlocked when the service exits. Enable with <code>systemctl --user enable i3lock</code> so its started upon triggering the <code>graphical-lock</code> target, which by default occurs when the session becomes inactive and before suspending the system.</p><h3>Other services</h3><p>Additional services (e.g. a compositor) can be started with the session by creating <em>systemd</em> service files in <code>~/.config/systemd/user</code> containing:</p><pre class="language-systemd"><code class="language-systemd"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">PartOf</span><span class="token punctuation">=</span><span class="token value attr-value">graphical-session.target</span></code></pre><p>and:</p><pre class="language-systemd"><code class="language-systemd"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span><br><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">graphical-session.target</span></code></pre><p>Enable such services with <code>systemctl --user enable &lt;service&gt;</code>.</p><h3>Inhibiting idling</h3><p>It's often desirable to prevent the session from idling while, for instance, watching a video. <code>sessiond-inhibit</code> comes to the rescue:</p><pre class="language-shell"><code class="language-shell">sessiond-inhibit -y <span class="token string">'movie night'</span> mpv <span class="token punctuation">..</span>.</code></pre><p>This can be automated if your window manager supports client rules and some level of scripting.</p><h2>More information</h2><p>For more information about sessiond, visit its <a href="https://sessiond.org/">website</a>.</p><p>You should now be equipped with sufficient knowledge to go forth and manage your own sessions!</p></div></article></div></div></main><footer class="flex gap-x-1 py-10"><p class="text-gray-500">&nbsp;&copy; 2022</p><a class="hover:underline" href="https://twiddlingbits.net/">James Reed</a></footer></body></html>