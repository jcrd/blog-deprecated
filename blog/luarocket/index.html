<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="bits of blogging"><meta name="generator" content="Eleventy"><link rel="icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>luarocket, or vendoring Lua rocks</title><link rel="stylesheet" href="/site.css"><link rel="stylesheet" href="/prism-one-dark.css"></head><body class="flex flex-col min-h-screen mx-6 md:mx-auto my-auto max-w-2xl"><main class="flex-grow pt-6 md:pt-12"><div class="flex flex-col md-960:flex-row"><div class="mb-4 md-960:-ml-32 md-960:mr-8"><a href="https://twiddlingbits.net/"><img src="https://www.gravatar.com/avatar/6dd0c8e5214e4c4d0f0dafabebe82c3d?size=96"></a></div><div class="pt-4"><article class="space-y-24"><div class="flex flex-col gap-y-5"><h1 class="text-4xl font-bold">luarocket, or vendoring Lua rocks</h1><div class="flex gap-x-2 text-gray-400"><div class="flex gap-x-1">Last updated: <span class="italic">Apr 24, 2022</span></div>&bull;<div class="flex gap-x-1"><span>2 min </span>read</div></div></div><div class="prose"><p>The Lua programming language, like many others, employs a purpose-built package manager to download and install its ecosystem of libraries. This tool, <a href="https://luarocks.org/">LuaRocks</a>, has some notable features:</p><ul><li>downloads/installs packages to user-specific or system-wide locations</li><li>configurable dependency resolution</li><li>builds locally define rocks (Lua modules packaged by LuaRocks)</li><li>queries information about the active LuaRocks configuration</li></ul><p>In these ways, LuaRocks is functionally similar to the package managers of other dynamic languages such as <a href="https://pip.pypa.io/en/stable/">pip</a> for Python and <a href="https://www.npmjs.com/">npm</a> for JavaScript.</p><p>Where these features fall short is in managing the dependencies of multiple Lua projects—each with a potentially different version of Lua. Being that Lua is an <a href="https://www.lua.org/pil/24.html"><em>embedded language</em></a>, this is in fact common, and further exacerbated by the popularity of both the reference <a href="https://www.lua.org/">Lua</a> implementation and <a href="https://luajit.org/">luajit</a>.</p><h2>Problem</h2><p>I encountered this issue during the development of an experimental window manager, <a href="https://github.com/jcrd/dovetail">dovetail</a>. It is based on the <a href="https://awesomewm.org/">awesome window manager</a> framework, which can be built with Lua versions 5.1-5.3 or luajit. It also depends on a few Lua packages, and therein lies the problem. It quickly became an overwhelming task to unify the range of Lua versions and implementations, 3rd party packages, varying installation paths, and integration with an embedded interpreter.</p><h2>Solution</h2><p>After consideration of my options, I decided the easiest solution was to vendor all dependency packages. I set up Makefile rules to download the version of packages specified in a version-controlled file to a specific Lua rocks tree where the package’s files are extracted and moved into a <code>lua_modules</code> directory in the root of the project. During installation, these modules are copied to a system-wide shared data directory and referenced by awesome’s Lua interpreter.</p><p>When I required this functionality outside of the dovetail project, I re-implemented these Makefile rules as a shell script called <a href="https://github.com/jcrd/luarocket">luarocket</a>. It is meant to be included directly in a project and utilized as part of its build process.</p><h2>References</h2><ul><li><a href="https://github.com/jcrd/luarocket">luarocket</a>: Vendor Lua rocks into a local project directory</li></ul></div></article></div></div></main><footer class="flex gap-x-1 py-10"><p class="text-gray-500">&nbsp;&copy; 2022</p><a class="hover:underline" href="https://twiddlingbits.net/">James Reed</a></footer></body></html>