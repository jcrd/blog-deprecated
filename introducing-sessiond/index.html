<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Introducing sessiond</title><script data-goatcounter=https://twiddlingbits.goatcounter.com/count async src=//gc.zgo.at/count.js></script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://twiddlingbits.net/index.xml title="twiddling bits"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introducing sessiond"><meta name=twitter:description content="When I began using Linux on the desktop in ~2012, I experimented with the prevalent desktop environments (Gnome, KDE, etc.), but was quickly drawn into the realm of tiling window managers by their promise of increased productivity and customization. While I believe these promises were fulfilled, tiling window managers were not without a significant shortcoming: they are solely window managers, lacking the integrated suite of software and applications that put the environment in desktop environments."><link rel=stylesheet href=https://twiddlingbits.net/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://twiddlingbits.net/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme')
var storedTheme=localStorage.getItem('dark-mode-storage')
if(storedTheme==='dark'){darkTheme.disabled=false}else if(storedTheme==='light'){darkTheme.disabled=true}</script><script src=https://twiddlingbits.net/js/main.bundle.js></script><script src=https://twiddlingbits.net/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.80.0"></head><body><header><nav class=navbar><div class=nav><a href=https://twiddlingbits.net/ class=nav-logo><img src=https://twiddlingbits.net/images/icon.png width=40 height=40 alt=logo></a><ul class=nav-links><li><a href=/about/ id=about><em class="fas fa-user fa-lg"></em></a></li><li><a href=/categories id=categories><em class="fas fa-folder-open fa-lg"></em></a></li><li><a href=/tags id=tags><em class="fas fa-tag fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>Introducing sessiond</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>When I began using Linux on the desktop in ~2012, I experimented with the
prevalent desktop environments (Gnome, KDE, etc.), but was quickly drawn into
the realm of tiling window managers by their promise of increased productivity
and customization. While I believe these promises were fulfilled, tiling window
managers were not without a significant shortcoming: they are solely window
managers, lacking the integrated suite of software and applications that put the
environment in desktop environments. The most noticeable omission was proper
<em>session management</em>, which facilitates, for instance: locking the screen or
suspending the system after a period of inactivity. This was not a dealbreaker
on a desktop computer, but using a laptop without these features felt like a
dysfunctional hack.</p><p>It would be quite a few more years of exploring the universe of tiling window
managers before deciding to address this issue myself, and with the broad
adoption of <em>systemd</em> by the larger Linux ecosystem, it was easier than ever.
Enter: <strong>sessiond</strong>, a standalone session manager for Linux.</p><nav id=TableOfContents><ul><li><a href=#what-does-it-do>What does it do?</a></li><li><a href=#how-do-i-use-it>How do I use it?</a><ul><li><a href=#installation>Installation</a></li><li><a href=#setting-up-your-window-manager>Setting up your window manager</a></li><li><a href=#locking-the-session>Locking the session</a></li><li><a href=#other-services>Other services</a></li><li><a href=#inhibiting-idling>Inhibiting idling</a></li></ul></li><li><a href=#more-information>More information</a></li></ul></nav><h2 id=what-does-it-do>What does it do?</h2><p>sessiond is a daemon for <em>systemd</em>-based Linux systems that interfaces with
<em>systemd-logind</em> to provide the missing session management features to X11
window managers. Its primary responsibility is to monitor keyboard and mouse
activity to determine when a session has become idle, and to then act
accordingly. It is capable of:</p><ul><li>locking the screen when idle and before suspending the system</li><li>dimming the screen&rsquo;s backlight when idle</li><li>triggering <em>systemd</em> targets for use by the window manager or end user</li><li>optionally managing DPMS settings</li></ul><p>It also provides a DBus service so that it may be integrated with modern window
managers. For example, a window manager can prevent idling when a media player
is open by interacting with the DBus methods.</p><p>It is designed to be zero-configuration, providing sensible defaults, but allows
configuration if needed. See <a href=https://sessiond.org/configuration/>here</a> for additional details.</p><h2 id=how-do-i-use-it>How do I use it?</h2><p>sessiond requires a Linux system utilizing <em>systemd-logind</em>. It may be possible
to use <a href=https://github.com/elogind/elogind>elogind</a> but this has not been tested.</p><p><strong>Note</strong>: This brief tutorial assumes basic knowledge of <em>systemd</em>-based Linux
systems and the command-line.</p><h3 id=installation>Installation</h3><p>Currently, sessiond RPM packages are built for Fedora via <a href=https://copr.fedorainfracloud.org/coprs/jcrd/sessiond/>copr</a> and
installable with the following commands:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>dnf copr <span class=nb>enable</span> jcrd/sessiond
dnf install sessiond
</code></pre></div><p>I would like to see packages for other major distros in the future.
Until sessiond achieves world domination, it is recommended to build from source
by following <a href=https://sessiond.org/building/>these instructions</a>.</p><p>If you package sessiond for your distribution, please let me know by creating an
issue <a href=https://github.com/jcrd/sessiond.org/issues>here</a>.</p><h3 id=setting-up-your-window-manager>Setting up your window manager</h3><p>The intended way to use sessiond with your window manager of choice is to create
a custom <em>systemd</em> service in the <code>~/.config/systemd/user</code> directory.
For example, below is a <code>awesome.service</code> file that runs the
<a href=https://awesomewm.org/>Awesome</a> window manager:</p><div class=highlight><pre class=chroma><code class=language-systemd data-lang=systemd><span class=k>[Unit]</span>
<span class=na>Description</span><span class=o>=</span><span class=s>Awesome window manager</span>
<span class=na>Requires</span><span class=o>=</span><span class=s>sessiond-session.target</span>
<span class=na>After</span><span class=o>=</span><span class=s>sessiond.service</span>
<span class=na>PartOf</span><span class=o>=</span><span class=s>graphical-session.target</span>

<span class=k>[Service]</span>
<span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/awesome</span>

<span class=k>[Install]</span>
<span class=na>Alias</span><span class=o>=</span><span class=s>window-manager.service</span>
</code></pre></div><p>The options in the <code>[Unit]</code> section ensure your window manager is only running
alongside the sessiond daemon. The <code>Alias=</code> option in the <code>[Install]</code> section
lets sessiond know this service is the window manager so the session will be
stopped when it exits.</p><p>Next, enable the window manager service with
<code>systemctl --user enable awesome.service</code>.</p><p>Now, select the <code>sessiond session</code> entry via your display manager or set it as
the default in its configuration file. For example, if using <code>lightdm</code>, set
<code>user-session=sessiond</code> in <code>/etc/lightdm/lightdm.conf</code>.</p><h3 id=locking-the-session>Locking the session</h3><p>sessiond wouldn&rsquo;t be of much use without a means by which to lock the screen.
Create a service for your screen locker of choice in <code>~/.config/systemd/user</code>.
For example, here is a <code>i3lock.service</code> that runs <code>i3lock</code> as the
screen locker:</p><div class=highlight><pre class=chroma><code class=language-systemd data-lang=systemd><span class=k>[Unit]</span>
<span class=na>Description</span><span class=o>=</span><span class=s>Lock X session with i3lock</span>
<span class=na>PartOf</span><span class=o>=</span><span class=s>graphical-session.target</span>

<span class=k>[Service]</span>
<span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/i3lock</span>
<span class=na>ExecStopPost</span><span class=o>=</span><span class=s>/usr/bin/sessionctl unlock</span>

<span class=k>[Install]</span>
<span class=na>WantedBy</span><span class=o>=</span><span class=s>graphical-lock.target</span>
</code></pre></div><p>The <code>sessionctl unlock</code> command in <code>ExecStopPost</code> under the <code>[Service]</code> section
notifies sessiond that the session has been unlocked when the service exits.
Enable with <code>systemctl --user enable i3lock</code> so its started upon triggering the
<code>graphical-lock</code> target, which by default occurs when the session becomes
inactive and before suspending the system.</p><h3 id=other-services>Other services</h3><p>Additional services (e.g. a compositor) can be started with the session by
creating <em>systemd</em> service files in <code>~/.config/systemd/user</code> containing:</p><div class=highlight><pre class=chroma><code class=language-systemd data-lang=systemd><span class=k>[Unit]</span>
<span class=na>PartOf</span><span class=o>=</span><span class=s>graphical-session.target</span>
</code></pre></div><p>and:</p><div class=highlight><pre class=chroma><code class=language-systemd data-lang=systemd><span class=k>[Install]</span>
<span class=na>WantedBy</span><span class=o>=</span><span class=s>graphical-session.target</span>
</code></pre></div><p>Enable such services with <code>systemctl --user enable &lt;service></code>.</p><h3 id=inhibiting-idling>Inhibiting idling</h3><p>It&rsquo;s often desirable to prevent the session from idling while, for instance,
watching a video. <code>sessiond-inhibit</code> comes to the rescue:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>sessiond-inhibit -y <span class=s1>&#39;movie night&#39;</span> mpv ...
</code></pre></div><p>This can be automated if your window manager supports client rules and some
level of scripting.</p><h2 id=more-information>More information</h2><p>For more information about sessiond, visit its <a href=https://sessiond.org/>website</a>.</p><p>You should now be equipped with sufficient knowledge to go forth and manage your
own sessions!</p><div class=blog-tags><a href=https://twiddlingbits.net/tags/c/>C</a>&nbsp;
<a href=https://twiddlingbits.net/tags/linux/>Linux</a>&nbsp;</div></article></div><footer><div class=social-icons><a href=https://github.com/jcrd name=github><em class="fab fa-github fa-lg"></em></a></div><div class=container><p class="credits copyright"><a href=https://twiddlingbits.net/about>James Reed</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://twiddlingbits.net/>twiddling bits</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>