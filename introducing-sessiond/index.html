<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Introducing sessiond - twiddling bits</title><meta name=description content="bits of blogging"><meta name=generator content="Hugo 0.101.0"><link rel=stylesheet href="/css/main.min.cfaa039e236b43a822d2fa74dd8736b2aec26c297d2a9fe4d2dcea47387e3f8e.css"><script data-goatcounter=https://twiddlingbits.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body class="flex flex-col min-h-screen mx-6 md:mx-auto my-auto max-w-2xl"><main class="flex-grow pt-6 md:pt-12"><article class=gap-y-2><h1 class="text-2xl font-bold">Introducing sessiond</h1><div class=py-4><div class="flex gap-x-3 text-gray-500"><div class="flex gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg><span class=italic>Apr 4, 2021</span></div>&bull;<div class="flex gap-x-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3A9 9 0 113 12a9 9 0 0118 0z"/></svg><span class=italic>4 mins</span></div></div></div><div class="flex flex-col gap-y-6 md:gap-y-12"><div class=prose><p>When I began using Linux on the desktop in ~2012, I experimented with the
prevalent desktop environments (Gnome, KDE, etc.), but was quickly drawn into
the realm of tiling window managers by their promise of increased productivity
and customization. While I believe these promises were fulfilled, tiling window
managers were not without a significant shortcoming: they are solely window
managers, lacking the integrated suite of software and applications that put the
environment in desktop environments.</p><p>The most noticeable omission was proper <em>session management</em>, which facilitates,
for instance: locking the screen or suspending the system after a period of
inactivity. This was not a dealbreaker on a desktop computer, but using a laptop
without these features felt like a dysfunctional hack.</p><p>It would be quite a few more years of exploring the universe of tiling window
managers before deciding to address this issue myself, and with the broad
adoption of <em>systemd</em> by the larger Linux ecosystem, it was easier than ever.
Enter: <strong>sessiond</strong>, a standalone session manager for Linux.</p><h2 id=what-does-it-do>What does it do?</h2><p>sessiond is a daemon for <em>systemd</em>-based Linux systems that interfaces with
<em>systemd-logind</em> to provide the missing session management features to X11
window managers. Its primary responsibility is to monitor keyboard and mouse
activity to determine when a session has become idle, and to then act
accordingly. It is capable of:</p><ul><li>locking the screen when idle and before suspending the system</li><li>dimming the screen&rsquo;s backlight when idle</li><li>triggering <em>systemd</em> targets for use by the window manager or end user</li><li>optionally managing DPMS settings</li><li>controlling keyboard and monitor backlight brightness</li><li>controlling audio sink volume and mute state <strong>*</strong></li></ul><div class="flex flex-col"><div class="$color rounded-t font-bold">&nbsp;* Update</div><div class="border border-t-0 rounded-b p-1"><span>The audio sink interface is new in
version <strong>0.6.0</strong>.</span></div></div><p>It also provides a DBus service so that it may be integrated with modern window
managers. For example, a window manager can prevent idling when a media player
is open by interacting with the DBus methods.</p><p>It is designed to be zero-configuration, providing sensible defaults, but allows
configuration if needed. See <a href=https://sessiond.org/configuration/>here</a> for additional details.</p><h2 id=how-do-i-use-it>How do I use it?</h2><p>sessiond requires a Linux system utilizing <em>systemd-logind</em>. It may be possible
to use <a href=https://github.com/elogind/elogind>elogind</a> but this has not been tested.</p><div class="flex flex-col"><div class="$color rounded-t font-bold">&nbsp;Note</div><div class="border border-t-0 rounded-b p-1"><span>This brief tutorial assumes basic knowledge of
<em>systemd</em>-based Linux systems and the command-line.</span></div></div><h3 id=installation>Installation</h3><p>Currently, sessiond RPM packages are built for Fedora via <a href=https://copr.fedorainfracloud.org/coprs/jcrd/sessiond/>copr</a> and
installable with the following commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>dnf copr <span class=nb>enable</span> jcrd/sessiond
</span></span><span class=line><span class=cl>dnf install sessiond
</span></span></code></pre></div><p>I would like to see packages for other major distros in the future. Until
sessiond achieves world domination, it is recommended to build from source by
following <a href=https://sessiond.org/building/>these instructions</a>.</p><p>If you package sessiond for your distribution, please let me know by creating an
issue <a href=https://github.com/jcrd/sessiond.org/issues>here</a>.</p><h3 id=setting-up-your-window-manager>Setting up your window manager</h3><p>The intended way to use sessiond with your window manager of choice is to create
a custom <em>systemd</em> service in the <code>~/.config/systemd/user</code> directory. For
example, below is a <code>awesome.service</code> file that runs the <a href=https://awesomewm.org/>Awesome</a>
window manager:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Awesome window manager</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>sessiond-session.target</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>sessiond.service</span>
</span></span><span class=line><span class=cl><span class=na>PartOf</span><span class=o>=</span><span class=s>graphical-session.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/awesome</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>Alias</span><span class=o>=</span><span class=s>window-manager.service</span>
</span></span></code></pre></div><p>The options in the <code>[Unit]</code> section ensure your window manager is only running
alongside the sessiond daemon. The <code>Alias=</code> option in the <code>[Install]</code> section
lets sessiond know this service is the window manager so the session will be
stopped when it exits.</p><p>Next, enable the window manager service with
<code>systemctl --user enable awesome.service</code>.</p><p>Now, select the <code>sessiond session</code> entry via your display manager or set it as
the default in its configuration file. For example, if using <code>lightdm</code>, set
<code>user-session=sessiond</code> in <code>/etc/lightdm/lightdm.conf</code>.</p><h3 id=locking-the-session>Locking the session</h3><p>sessiond wouldn&rsquo;t be of much use without a means by which to lock the screen.
Create a service for your screen locker of choice in <code>~/.config/systemd/user</code>.
For example, here is a <code>i3lock.service</code> that runs <code>i3lock</code> as the screen locker:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Lock X session with i3lock</span>
</span></span><span class=line><span class=cl><span class=na>PartOf</span><span class=o>=</span><span class=s>graphical-session.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/i3lock</span>
</span></span><span class=line><span class=cl><span class=na>ExecStopPost</span><span class=o>=</span><span class=s>/usr/bin/sessionctl unlock</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>graphical-lock.target</span>
</span></span></code></pre></div><p>The <code>sessionctl unlock</code> command in <code>ExecStopPost</code> under the <code>[Service]</code> section
notifies sessiond that the session has been unlocked when the service exits.
Enable with <code>systemctl --user enable i3lock</code> so its started upon triggering the
<code>graphical-lock</code> target, which by default occurs when the session becomes
inactive and before suspending the system.</p><h3 id=other-services>Other services</h3><p>Additional services (e.g. a compositor) can be started with the session by
creating <em>systemd</em> service files in <code>~/.config/systemd/user</code> containing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>PartOf</span><span class=o>=</span><span class=s>graphical-session.target</span>
</span></span></code></pre></div><p>and:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>graphical-session.target</span>
</span></span></code></pre></div><p>Enable such services with <code>systemctl --user enable &lt;service></code>.</p><h3 id=inhibiting-idling>Inhibiting idling</h3><p>It&rsquo;s often desirable to prevent the session from idling while, for instance,
watching a video. <code>sessiond-inhibit</code> comes to the rescue:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sessiond-inhibit -y <span class=s1>&#39;movie night&#39;</span> mpv ...
</span></span></code></pre></div><p>This can be automated if your window manager supports client rules and some
level of scripting.</p><h2 id=more-information>More information</h2><p>For more information about sessiond, visit its <a href=https://sessiond.org/>website</a>.</p><p>You should now be equipped with sufficient knowledge to go forth and manage your
own sessions!</p></div></div></article><div class=pt-8><div class="flex ml-1 italic text-sm text-gray-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-4" fill="currentcolor" viewBox="0 0 20 24"><path fill-rule="evenodd" d="M1.5 1.5A.5.5.0 001 2v4.8a2.5 2.5.0 002.5 2.5h9.793l-3.347 3.346a.5.5.0 00.708.708l4.2-4.2a.5.5.0 000-.708l-4-4a.5.5.0 00-.708.708L13.293 8.3H3.5A1.5 1.5.0 012 6.8V2a.5.5.0 00-.5-.5z"/></svg>edited: January 25, 2022</div></div></main><div class=py-10><footer class="flex gap-x-1"><p class=text-gray-500>&nbsp;&copy;
2022</p><a class=hover:underline href=https://twiddlingbits.net>James Reed</a>
<a class=text-gray-300 type=application/rss+xml href=https://twiddlingbits.net/posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-4" viewBox="0 0 20 20" fill="currentcolor"><path d="M5 3a1 1 0 000 2c5.523.0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"/><path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5A1 1 0 014 9zM3 15a2 2 0 114 0 2 2 0 01-4 0z"/></svg></a></footer></div></body></html>